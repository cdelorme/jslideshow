(function(window){var controller;var slideShow=function(context,config){this.setContext(context);this.setConfig(config)};slideShow.prototype.delay=3e3;slideShow.prototype.transition=300;slideShow.prototype.notify={styles:{position:"absolute",width:"200px",textAlign:"center",left:"50%",top:"5px",padding:"4px",background:"#fff",marginLeft:"-100px",borderRadius:"8px",zIndex:"10","-webkit-transition":"opacity 0.5s linear"}};slideShow.prototype.setContext=function(context){if(this.context&&this.image){this.context.removeChild(this.image)}if(context){this.context=context;this.context.appendChild(this.getImage())}};slideShow.prototype.getImage=function(){if(!this.image){this.image=new Image;this.setImageTransition()}return this.image};slideShow.prototype.setImageTransition=function(){this.image.style["-webkit-transition"]="opacity "+this.transition/1e3+"s linear"};slideShow.prototype.setConfig=function(config){for(key in config){var method="set"+key.charAt(0).toUpperCase()+key.slice(1);if(this[method]){this[method](config[key])}}};slideShow.prototype.setTransition=function(value){this.transition=value;this.setImageTransition()};slideShow.prototype.setDelay=function(delay){if(delay&&delay>2*this.transition){this.delay=delay}};slideShow.prototype.getDelay=function(){var slide=this.getCurrentSlide();return slide&&slide.delay?slide.delay:this.delay};slideShow.prototype.setControls=function(controls){this.controls=controls;if(controller){if(this.controls){if(controller!==this){window.removeEventListener(controller,this.keyboard);window.removeEventListener(controller,this.mouse)}window.addEventListener("keyup",this.keyboard.bind(this));window.addEventListener("click",this.mouse.bind(this));controller=this}else if(controller===this){window.removeEventListener(controller,this.keyboard);window.removeEventListener(controller,this.mouse)}}else if(this.controls){window.addEventListener("keyup",this.keyboard.bind(this));window.addEventListener("click",this.mouse.bind(this));controller=this}};slideShow.prototype.setNotify=function(notify){if(!notify.styles){notify.styles=this.notify.styles}this.notify=notify;this.display=document.createElement("div");this.display.appendChild(document.createTextNode(""));for(style in this.notify.styles){this.display.style[style]=this.notify.styles[style]}this.display.style.opacity="0";if(this.image.parentNode){this.image.parentNode.insertBefore(this.display,this.image.nextSibling)}if(this.notify.info){this.image.addEventListener("mouseover",this.info.bind(this));this.image.addEventListener("mouseout",this.fadeDisplay.bind(this))}else{this.image.removeEventListener("mouseover",this.info);this.image.removeEventListener("mouseout",this.fadeDisplay)}if(this.notify.actions){this.setControls(true)}};slideShow.prototype.fadeDisplay=function(){this.display.style.opacity="0"};slideShow.prototype.action=function(command){this.display.firstChild.data="Action: "+command;this.display.style.opacity="1";setTimeout(this.fadeDisplay.bind(this),1e3)};slideShow.prototype.info=function(){this.display.firstChild.data="Image: "+this.getCurrentSlide().src;this.display.style.opacity="1"};slideShow.prototype.keyboard=function(e){if(e.keyCode){if(e.keyCode==32){this.toggle();if(this.running){this.action("Resumed")}else{this.action("Paused")}}else if(e.keyCode==37){this.backward();this.action("Previous")}else if(e.keyCode==39){this.forward();this.action("Next")}}};slideShow.prototype.mouse=function(){this.forward();this.action("Next")};slideShow.prototype.setImages=function(images){delete this.slides;this.slides=[];delete this.images;this.images={};for(index in images){var row=images[index];if(typeof row==="object"){if(row.image){var slide={src:row.image};if(row.delay){slide.delay=row.delay}this.slides.push(slide);if(!this.images[row.image]){this.images[row.image]={}}}else if(row.start&&row.end&&row.type){for(var n=row.start;n<=row.end;n++){var image=n;if(row.prefix){image=row.prefix+image}image=image+row.type;var slide={src:image};if(row.delay){slide.delay=row.delay}this.slides.push(slide);if(!this.images[image]){this.images[image]={}}}}}else if(typeof row==="string"){var slide={src:row};this.slides.push(slide);if(!this.images[row]){this.images[row]={}}}}this.loading=this.getImageCount()-1;this.preload()};slideShow.prototype.getImageKeys=function(){return Object.keys(this.images)};slideShow.prototype.getImageCount=function(){return this.getImageKeys().length};slideShow.prototype.getCurrentImage=function(){var source=this.slides[this.index];return this.images[source.src]};slideShow.prototype.getSlidesCount=function(){return this.slides.length};slideShow.prototype.getCurrentSlide=function(){return this.slides[this.index]};slideShow.prototype.preload=function(){var self=this;for(source in this.images){if(!this.images[source].error){var image=new Image;image.alt=source;image.addEventListener("error",function(e){e.preventDefault();self.remove(this.alt);self.images[this.alt].error=true;self.preload()});image.addEventListener("load",function(){self.images[this.alt].height=this.height;self.images[this.alt].width=this.width;self.images[this.alt].src=this.src;if(self.loading){self.loading--}else{delete self.loading;if(self.waiting){delete self.waiting;self.start()}}if(arguments&&arguments.callee){this.removeEventListener(this,arguments.callee)}});image.src=source}}};slideShow.prototype.insert=function(url,pos){if(pos||post===0){this.slides.splice(pos,0,url)}else{this.slides.push(url)}};slideShow.prototype.remove=function(url,n){var track=0;for(var i in this.slides){if(this.slides[i].src==url){if(n&&n>track){track++}else{this.slides.splice(i,1)}}}};slideShow.prototype.start=function(){if(this.loading){this.waiting=true}else if(!this.running&&this.images){this.running=true;if(typeof this.index!=="undefined"){this.interval=setTimeout(function(){if(this.running){this.clear();this.forward()}}.bind(this),this.getDelay())}else{this.forward()}}};slideShow.prototype.pause=function(){if(this.running){delete this.running;this.clear()}};slideShow.prototype.clear=function(){if(this.interval){clearTimeout(this.interval);delete this.interval}};slideShow.prototype.toggle=function(){if(this.running){this.pause()}else{this.start()}};slideShow.prototype.stop=function(){this.pause();delete this.index};slideShow.prototype.forward=function(){this.clear();if(typeof this.index==="undefined"||this.index==this.getSlidesCount()-1){this.index=-1}this.index++;this.render();this.interval=setTimeout(function(){if(this.running){this.clear();this.forward()}}.bind(this),this.getDelay())};slideShow.prototype.backward=function(){this.clear();if(!this.index||this.index<0){this.index=this.getSlidesCount()}this.index--;this.interval=setTimeout(function(){if(this.running){this.forward()}}.bind(this),this.getDelay());this.render()};slideShow.prototype.render=function(){slide=this.getCurrentSlide();if(this.transition){this.image.style.opacity="0";setTimeout(function(){this.image.src=slide.src;this.resizeImage();if(this.display){this.display.firstChild.data="Image: "+slide.src}this.image.style.opacity="1"}.bind(this),this.transition)}else{this.image.src=slide.src;this.resizeImage()}};slideShow.prototype.resizeImage=function(){var windowSize=this.getBoundingBox();image=this.getCurrentImage();var ratio=image.width/image.height;var windowRatio=windowSize.width/windowSize.height;if(ratio<windowRatio){this.image.style.height="100%";this.image.style.width="auto"}else{this.image.style.width="100%";this.image.style.height="auto"}};slideShow.prototype.getBoundingBox=function(){var width=0;var height=0;var parent=this.parentNode;if(parent){width=parent.clientWidth;height=parent.clientHeight}else{width=window.innerWidth;height=window.innerHeight}return{width:width,height:height}};window.ss=function(context,config){return new slideShow(context,config)}})(window);